<div class="receptionist-layout" [class.dark]="themeService.isDark()">
  <app-header></app-header>
  <div class="body">
    <app-sidebar [title]="'QuickMed'" [menuItems]="menuItems" [secondaryItems]="secondaryItems"></app-sidebar>

    <main class="panel">
      <!-- Section: Header -->
      <section class="dashboard-header">
        <div class="title-group">
          <div class="brand-chip">
            <div class="logo-wrapper">
              <img src="assets/images/QuickMed-Logo.png" alt="QuickMed Logo" />
            </div>
            <div>
              <p class="eyebrow">QuickMed Enterprise</p>
              <h1>Receptionist Dashboard</h1>
            </div>
          </div>
          <p class="subtitle">Manage check-ins, payments, and appointments with surgical precision.</p>
        </div>
        <div class="header-actions">
          <button class="refresh-btn" (click)="loadDashboard()" [disabled]="isLoading()">
            <i class="bi bi-arrow-clockwise" [class.spin]="isLoading()"></i>
            {{ isLoading() ? 'Refreshing...' : 'Refresh Data' }}
          </button>
        </div>
      </section>

      <!-- Section: Stats Strip -->
      <section class="stats-strip" *ngIf="stats() as metric">
        <div class="stat-card glass-card">
          <div class="stat-icon-wrap today">
            <i class="bi bi-calendar-event"></i>
          </div>
          <div class="stat-info">
            <span class="stat-label">Today's Visits</span>
            <span class="stat-value">{{ metric.totalToday }}</span>
          </div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-icon-wrap checkin">
            <i class="bi bi-person-check"></i>
          </div>
          <div class="stat-info">
            <span class="stat-label">Checked In</span>
            <span class="stat-value">{{ metric.checkedIn || 0 }}</span>
          </div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-icon-wrap payment">
            <i class="bi bi-currency-dollar"></i>
          </div>
          <div class="stat-info">
            <span class="stat-label">Payments Due</span>
            <span class="stat-value">{{ metric.paymentsDue }}</span>
          </div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-icon-wrap message">
            <i class="bi bi-chat-left-dots"></i>
          </div>
          <div class="stat-info">
            <span class="stat-label">Messages</span>
            <span class="stat-value">{{ metric.messages || 0 }}</span>
          </div>
        </div>
      </section>

      <!-- Section: Quick Actions -->
      <section class="quick-actions">
        <button class="action-btn primary" (click)="goToRegisterPatient()">
          <i class="bi bi-person-plus-fill"></i>
          Register Patient
        </button>
        <button class="action-btn secondary" (click)="goToBookAppointment()">
          <i class="bi bi-calendar-plus-fill"></i>
          Book Appointment
        </button>
        <button class="action-btn secondary" (click)="goToMessages()">
          <i class="bi bi-chat-square-text-fill"></i>
          Internal Comms
        </button>
      </section>

      <!-- Section: Main Table -->
      <section class="table-container">
        <header class="table-header">
          <div class="table-title">
            <h3><i class="bi bi-card-list"></i> Appointment Queue</h3>
            <p>Live tracking of patient arrivals and clinical status.</p>
          </div>
          <div class="table-filters">
            <div class="search-box">
              <i class="bi bi-search"></i>
              <input type="text" placeholder="Search patient or doctor..." [(ngModel)]="searchQuery"
                (input)="onSearch()" />
            </div>
            <span class="badge" *ngIf="appointmentsTable().length > 0">{{ appointmentsTable().length }} appointments
              today</span>
          </div>
        </header>

        <div class="table-wrapper glass-card" *ngIf="appointmentsTable().length; else emptyTable">
          <table class="table-responsive-stack">
            <thead>
              <tr>
                <th>Patient</th>
                <th>Doctor</th>
                <th>Schedule</th>
                <th>Status</th>
                <th class="text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of appointmentsTable()" class="table-row">
                <td data-label="Patient">
                  <div class="patient-cell">
                    <div class="patient-avatar">{{ row.patient?.firstName?.[0] || 'P' }}</div>
                    <div class="patient-meta">
                      <span class="p-name">{{ row.patientName || (row.patient?.firstName + ' ' + row.patient?.lastName)
                        }}</span>
                      <span class="p-email">{{ row.patient?.email }}</span>
                    </div>
                  </div>
                </td>
                <td data-label="Doctor">
                  <div class="doctor-cell">
                    <i class="bi bi-stethoscope"></i>
                    Dr. {{ row.doctorName || (row.doctor?.firstName + ' ' + row.doctor?.lastName) }}
                  </div>
                </td>
                <td data-label="Schedule">
                  <div class="time-cell">
                    <i class="bi bi-clock"></i>
                    {{ row.time || row.appointmentTime }}
                  </div>
                </td>
                <td data-label="Status">
                  <span class="status-pill" [class]="getStatusClass(row)">
                    {{ getStatusLabel(row) }}
                  </span>
                </td>
                <td data-label="Actions" class="text-right">
                  <div class="action-group">
                    <button class="checkin-btn" *ngIf="canCheckIn(row)" (click)="markCheckedIn(row.id)">
                      <i class="bi bi-box-arrow-in-right"></i> Check-in
                    </button>
                    <ng-container *ngIf="canModify(row)">
                      <button class="complete-btn" title="Mark as Completed"
                        (click)="updateStatus(row.id, 'completed')">
                        <i class="bi bi-check-lg"></i>
                      </button>
                      <button class="cancel-btn" title="Cancel Appointment" (click)="updateStatus(row.id, 'cancelled')">
                        <i class="bi bi-x-lg"></i>
                      </button>
                    </ng-container>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <ng-template #emptyTable>
          <div class="empty-state glass-card">
            <div class="empty-icon"><i class="bi bi-search" *ngIf="searchQuery()"></i><i class="bi bi-calendar-x"
                *ngIf="!searchQuery()"></i></div>
            <h4>{{ searchQuery() ? 'No results found' : 'Quiet day ahead' }}</h4>
            <p>{{ searchQuery() ? 'Try a different search term.' : 'No appointments registered for today yet.' }}</p>
            <button class="action-btn primary sm mx-auto" *ngIf="!searchQuery()" (click)="goToBookAppointment()">Book
              first visit</button>
            <button class="action-btn secondary sm mx-auto" *ngIf="searchQuery()"
              (click)="searchQuery.set(''); onSearch()">Clear Search</button>
          </div>
        </ng-template>
      </section>
    </main>
  </div>
</div>