<div class="receptionist-layout">
  <app-header></app-header>
  <div class="body">
    <app-sidebar
      [title]="'QuickMed'"
      [menuItems]="menuItems"
      [secondaryItems]="secondaryItems"
    ></app-sidebar>
    <main class="panel">
      <section class="dashboard-header">
        <div class="title-group">
          <div class="brand-chip">
            <img src="assets/images/QuickMed-Logo.png" alt="QuickMed Logo" />
            <div>
              <p class="eyebrow">QuickMed</p>
              <h1>Receptionist Dashboard</h1>
            </div>
          </div>
          <p class="subtitle">Manage check-ins, payments, and appointments with precision.</p>
        </div>
        <div class="header-actions">
          <button class="ghost" type="button" title="Notifications">
            <i class="bi bi-bell"></i>
          </button>
          <div class="avatar">
            <span>{{ (authService.currentUser()?.firstName?.charAt(0) || 'R') + (authService.currentUser()?.lastName?.charAt(0) || 'C') }}</span>
          </div>
          <button class="refresh" (click)="loadDashboard()" [disabled]="isLoading()">
            <i class="bi bi-arrow-clockwise" *ngIf="!isLoading(); else loading"></i>
            <ng-template #loading><span class="spinner"></span></ng-template>
            Refresh
          </button>
        </div>
      </section>

      <section class="summary" *ngIf="stats() as metric">
        <div class="summary-card">
          <p>Today’s Appointments</p>
          <h2>{{ metric.totalToday }}</h2>
        </div>
        <div class="summary-card">
          <p>Checked-in Patients</p>
          <h2>{{ metric.checkedIn || 0 }}</h2>
        </div>
        <div class="summary-card">
          <p>Pending Payments</p>
          <h2>{{ metric.paymentsDue }}</h2>
        </div>
        <div class="summary-card">
          <p>Messages</p>
          <h2>{{ metric.messages || 0 }}</h2>
        </div>
      </section>

      <section class="quick-actions">
        <button class="primary" type="button" (click)="goToRegisterPatient()">
          <i class="bi bi-person-plus"></i>
          Register New Patient
        </button>
        <button class="ghost" type="button" (click)="goToBookAppointment()">
          <i class="bi bi-calendar-plus"></i>
          Book Appointment
        </button>
        <button class="ghost" type="button" (click)="goToMessages()">
          <i class="bi bi-chat-dots"></i>
          Send Message
        </button>
      </section>

      <section class="table-card">
        <header class="table-header">
          <div>
            <h3>Appointment list</h3>
            <p class="muted">Track today’s arrivals and update statuses instantly.</p>
          </div>
        </header>

        <div class="table-wrap" *ngIf="appointmentsTable().length; else emptyTable">
          <table>
            <thead>
              <tr>
                <th>Patient Name</th>
                <th>Doctor</th>
                <th>Time</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of appointmentsTable()">
                <td>{{ row.patientName || (row.patient?.firstName + ' ' + row.patient?.lastName) }}</td>
                <td>{{ row.doctorName || (row.doctor?.firstName + ' ' + row.doctor?.lastName) }}</td>
                <td>{{ row.time || row.appointmentTime }}</td>
                <td><span [class]="getStatusClass(row)">{{ getStatusLabel(row) }}</span></td>
                <td class="actions">
                  <button class="ghost" type="button" (click)="markCheckedIn(row.id)" [disabled]="row.arrived">
                    Check-in
                  </button>
                  <button class="ghost" type="button" (click)="updateStatus(row.id, 'completed')">
                    Complete
                  </button>
                  <button class="ghost danger" type="button" (click)="updateStatus(row.id, 'cancelled')">
                    Cancel
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <ng-template #emptyTable>
          <p class="muted">No appointments available for today.</p>
        </ng-template>
      </section>
    </main>
  </div>
</div>
