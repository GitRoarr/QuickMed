<div class="doctor-schedule">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">
          <img src="assets/images/QuickMed-Logo.png" alt="QuickMed Logo" class="h-8 w-8 rounded" />
        </div>
        <div class="logo-text">
          <h3>QuickMed</h3>
          <p>Doctor Portal</p>
        </div>
      </div>
    </div>

            <nav class="sidebar-nav">
              <a
                *ngFor="let item of menuItems()"
                [routerLink]="item.route"
                routerLinkActive="active"
                class="nav-item"
              >
                <i [class]="'bi ' + item.icon"></i>
                <span>{{ item.label }}</span>
                <span *ngIf="item.badge && item.badge > 0" class="badge">{{ item.badge }}</span>
              </a>
            </nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">
          <img *ngIf="currentUser()?.avatar; else docInitials" [src]="currentUser()?.avatar" alt="Doctor avatar" />
          <ng-template #docInitials>{{ getDoctorInitials() }}</ng-template>
        </div>
        <div class="user-details">
          <p class="user-name">Dr. {{ getDoctorName() }}</p>
          <p class="user-role">{{ getDoctorSpecialty() }}</p>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">
        <i class="bi bi-box-arrow-right"></i>
        Logout
      </button>
    </div>
  </aside>

 
  <!-- Main Content -->
  <main class="main-content">
    <header class="content-header">
      <div>
        <h1 class="page-title">My Schedule</h1>
        <p class="page-subtitle">View and manage your appointment schedule</p>
      </div>
    </header>

    <div class="schedule-container">
      <!-- Calendar View -->
      <div class="calendar-section">
        <div class="calendar-header">
          <button class="nav-btn" (click)="previousMonth()"><i class="bi bi-chevron-left"></i></button>
          <h2 class="month-year">{{ getMonthYear() }}</h2>
          <button class="nav-btn" (click)="nextMonth()"><i class="bi bi-chevron-right"></i></button>
        </div>

        <div class="calendar-grid">
          <div class="calendar-weekdays">
            <div class="weekday" *ngFor="let day of ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']">
              {{ day }}
            </div>
          </div>
          <div class="calendar-days">
            <button
              *ngFor="let date of getCalendarDays()"
              class="calendar-day"
              [class.today]="isToday(date)"
              [class.selected]="isSelected(date)"
              [class.other-month]="!isCurrentMonth(date)"
              (click)="selectDate(date)"
            >
              {{ date.getDate() }}
            </button>
          </div>
        </div>
      </div>

      <!-- Daily Schedule -->
      <div class="schedule-section">
        <div class="schedule-header">
          <h3>Schedule for {{ selectedDate() | date:'MMMM d, yyyy' }}</h3>
          <p class="appointment-count">{{ getSelectedDateAppointments().length }} appointments scheduled</p>
        </div>

        <ng-container *ngIf="(slots() || []).length > 0; else noSlots">
          <div class="schedule-list">
            <div *ngFor="let slot of getTimeSlots()" class="schedule-item">
              <div class="time-label">{{ slot }} {{ slot < '12:00' ? 'AM' : 'PM' }}</div>

              <div class="slot-content" [ngClass]="getSlotStatus(slot)">
                <ng-container *ngIf="getAppointmentForSlot(slot); else availableSlot">
                  <div class="appointment-details">
                    <div class="patient-name">
                      {{ getAppointmentForSlot(slot)?.patient?.firstName }}
                      {{ getAppointmentForSlot(slot)?.patient?.lastName }}
                    </div>
                    <div class="appointment-type">{{ getAppointmentForSlot(slot)?.appointmentType || 'Consultation' }}</div>
                  </div>
                </ng-container>

                <ng-template #availableSlot>
                  <div class="available-slot">
                    <span>{{ getSlotStatus(slot) === 'blocked' ? 'Blocked' : 'Available' }}</span>
                    <button *ngIf="getSlotStatus(slot) !== 'booked'" 
                            (click)="getSlotStatus(slot) === 'available' ? blockSlot(slot) : setAvailable(slot)"
                            class="block-btn">
                      {{ getSlotStatus(slot) === 'available' ? 'Block' : 'Set Available' }}
                    </button>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>
        </ng-container>

        <ng-template #noSlots>
          <div class="no-slots">
            <p>No availability has been set for this date.</p>
            <div class="availability-card">
              <label>
                <input type="radio" name="mode" value="single" [checked]="availabilityMode() === 'single'" (change)="availabilityMode.set('single')" />
                Single time
              </label>
              <label style="margin-left:1rem;">
                <input type="radio" name="mode" value="range" [checked]="availabilityMode() === 'range'" (change)="availabilityMode.set('range')" />
                Range
              </label>

              <div class="availability-inputs" style="margin-top: .75rem; display:flex; gap: .5rem; align-items:center;">
                <div *ngIf="availabilityMode() === 'single'">
                  <input type="time" [ngModel]="singleTime()" (ngModelChange)="singleTime.set($event)" [ngModelOptions]="{standalone: true}" />
                </div>
                <div *ngIf="availabilityMode() === 'range'" style="display:flex; gap:.5rem;">
                  <input type="time" [ngModel]="rangeStart()" (ngModelChange)="rangeStart.set($event)" [ngModelOptions]="{standalone: true}" />
                  <span>to</span>
                  <input type="time" [ngModel]="rangeEnd()" (ngModelChange)="rangeEnd.set($event)" [ngModelOptions]="{standalone: true}" />
                </div>
                <button class="btn btn-primary" (click)="setAvailability()">Set Available</button>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </main>
</div>
