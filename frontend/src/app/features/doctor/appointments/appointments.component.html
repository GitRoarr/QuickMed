<div class="doctor-appointments">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">
          <img src="assets/images/QuickMed-Logo.png" alt="QuickMed Logo" class="h-8 w-8 rounded" />
        </div>
        <div class="logo-text">
          <h3>QuickMed</h3>
          <p>Doctor Portal</p>
        </div>
      </div>
    </div>

            <nav class="sidebar-nav">
              <a
                *ngFor="let item of menuItems()"
                [routerLink]="item.route"
                routerLinkActive="active"
                class="nav-item"
              >
                <i [class]="'bi ' + item.icon"></i>
                <span>{{ item.label }}</span>
                <span *ngIf="item.badge && item.badge > 0" class="badge">{{ item.badge }}</span>
              </a>
            </nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">
          <img *ngIf="currentUser()?.avatar; else docInitials" [src]="currentUser()?.avatar" alt="Doctor avatar" />
          <ng-template #docInitials>{{ getDoctorInitials() }}</ng-template>
        </div>
        <div class="user-details">
          <p class="user-name">Dr. {{ getDoctorName() }}</p>
          <p class="user-role">{{ getDoctorSpecialty() }}</p>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">
        <i class="bi bi-box-arrow-right"></i>
        Logout
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="doctor-topbar">
      <div class="doctor-topbar-actions">
        <button class="icon-btn" [routerLink]="'/doctor/messages'" title="Messages">
          <i class="bi bi-chat-dots"></i>
        </button>
        <button class="icon-btn" [routerLink]="'/doctor/notifications'" title="Notifications">
          <i class="bi bi-bell"></i>
        </button>
        <button class="icon-btn" (click)="setTheme('light')"><i class="bi bi-brightness-high"></i></button>
        <button class="icon-btn" (click)="setTheme('dark')"><i class="bi bi-moon"></i></button>
        <div class="avatar-sm">
          <img *ngIf="currentUser()?.avatar; else docSmall" [src]="currentUser()?.avatar" alt="Doctor" />
          <ng-template #docSmall>{{ getDoctorInitials() }}</ng-template>
        </div>
      </div>
    </div>
    <header class="content-header">
      <div>
        <h1 class="page-title">Appointments</h1>
        <p class="page-subtitle">Manage all your patient appointments</p>
      </div>
      <button class="btn-primary" (click)="navigate('/doctor/appointments')">
        <i class="bi bi-plus-circle"></i>
        New Appointment
      </button>
    </header>

    <!-- Search and Filter -->
    <div class="search-filter-section">
      <div class="search-bar">
        <div class="search-input-wrapper">
          <i class="bi bi-search search-icon"></i>
          <input
            type="text"
            placeholder="Search by patient name..."
            [value]="searchQuery()"
            (input)="searchQuery.set($any($event.target).value); onSearchChange()"
            class="search-input"
          />
        </div>
        <div class="filter-buttons">
          <button
            *ngFor="let option of filterOptions"
            [class]="'filter-btn ' + (selectedFilter() === option.value ? 'active' : '')"
            (click)="selectedFilter.set(option.value); onFilterChange()"
          >
            {{ option.label }}
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading-container">
      <div class="spinner"></div>
      <p>Loading appointments...</p>
    </div>

    <!-- Appointments List -->
    <div *ngIf="!isLoading()" class="appointments-list">
      <div
        *ngFor="let appointment of filteredAppointments"
        class="appointment-card"
      >
        <div class="appointment-header">
          <div class="patient-info">
            <div class="patient-avatar">
              {{ appointment.patient?.firstName?.charAt(0) }}{{ appointment.patient?.lastName?.charAt(0) }}
            </div>
            <div>
              <h3 class="patient-name">
                {{ appointment.patient?.firstName }} {{ appointment.patient?.lastName }}
              </h3>
              <div class="appointment-meta">
                <span class="appointment-type">{{ appointment.appointmentType || 'Consultation' }}</span>
                <span class="separator">•</span>
                <span class="appointment-time">{{ appointment.appointmentTime }}</span>
                <span class="separator">•</span>
                <span class="appointment-date">{{ appointment.appointmentDate | date:'MMM d, yyyy' }}</span>
              </div>
            </div>
          </div>
          <div class="appointment-status">
            <span [class]="'status-badge ' + getStatusClass(appointment.status)">
              <i [class]="getStatusIcon(appointment.status)"></i>
              {{ appointment.status | titlecase }}
            </span>
            <button class="more-btn">
              <i class="bi bi-three-dots-vertical"></i>
            </button>
          </div>
        </div>

        <div class="appointment-details">
          <div class="detail-item">
            <i class="bi bi-geo-alt"></i>
            <span>{{ appointment.isVideoConsultation ? 'Video' : 'In-Person' }}</span>
          </div>
          <div class="detail-item" *ngIf="appointment.notes">
            <i class="bi bi-file-text"></i>
            <span>{{ appointment.notes }}</span>
          </div>
        </div>

        <div class="appointment-actions">
          <button
            *ngIf="appointment.status === AppointmentStatus.PENDING"
            class="action-btn confirm"
            (click)="updateStatus(appointment.id, AppointmentStatus.CONFIRMED)"
          >
            <i class="bi bi-check-circle"></i>
            Confirm
          </button>
          <button
            *ngIf="appointment.status === AppointmentStatus.CONFIRMED"
            class="action-btn complete"
            (click)="updateStatus(appointment.id, AppointmentStatus.COMPLETED)"
          >
            <i class="bi bi-check2-all"></i>
            Complete
          </button>
          <button class="action-btn view" (click)="viewPatientDetails(appointment)">
            <i class="bi bi-eye"></i>
            View
          </button>
        </div>
      </div>

      <div *ngIf="filteredAppointments.length === 0" class="empty-state">
        <i class="bi bi-calendar-x"></i>
        <p>No appointments found</p>
      </div>
    </div>
  </main>
</div>
