<div class="doctor-dashboard">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header" title="Back to Home" (click)="navigate('/')" style="cursor: pointer;">
      <div class="logo">
        <div class="logo-icon">
          <img src="assets/images/QuickMed-Logo.png" alt="QuickMed Logo" class="h-8 w-8 rounded" />
        </div>
        <div class="logo-text">
          <h3>QuickMed</h3>
          <p>Doctor Portal</p>
        </div>
      </div>
    </div>

            <nav class="sidebar-nav">
              <a
                *ngFor="let item of menuItems()"
                [routerLink]="item.route"
                routerLinkActive="active"
                class="nav-item"
              >
                <i [class]="'bi ' + item.icon"></i>
                <span>{{ item.label }}</span>
                <span *ngIf="item.badge && item.badge > 0" class="badge">{{ item.badge }}</span>
              </a>
            </nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">
          <img *ngIf="currentUser()?.avatar; else docInitials" [src]="currentUser()?.avatar" alt="Doctor avatar" />
          <ng-template #docInitials>{{ getDoctorInitials() }}</ng-template>
        </div>
        <div class="user-details">
          <p class="user-name">Dr. {{ getDoctorName() }}</p>
          <p class="user-role">{{ getDoctorSpecialty() }}</p>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">
        <i class="bi bi-box-arrow-right"></i>
        Logout
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="content-header">
      <div>
        <h1 class="welcome-title">Welcome, Dr. {{ getDoctorName().split(' ')[0] }}</h1>
        <p class="welcome-subtitle">Here's your patient and appointment overview</p>
      </div>
      <button class="btn-primary" (click)="navigate('/doctor/appointments')">
        <i class="bi bi-plus-circle"></i>
        New Appointment
      </button>
    </header>

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading-container">
      <div class="spinner"></div>
      <p>Loading dashboard...</p>
    </div>

    <!-- Dashboard Content -->
    <div *ngIf="!isLoading() && dashboardData()" class="dashboard-content">
      <!-- KPI Cards -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-header">
            <h3>Today's Appointments</h3>
            <i class="bi bi-calendar-check kpi-icon"></i>
          </div>
          <div class="kpi-value">{{ dashboardData()!.stats.todayAppointments }}</div>
          <div class="kpi-footer">
            <span class="kpi-subtext">{{ dashboardData()!.stats.pendingConfirmations }} pending confirmations</span>
            <span class="kpi-trend positive">
              <i class="bi bi-arrow-up"></i>
              {{ dashboardData()!.trends.appointmentsChange }} from yesterday
            </span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-header">
            <h3>Total Patients</h3>
            <i class="bi bi-people kpi-icon"></i>
          </div>
          <div class="kpi-value">{{ dashboardData()!.stats.totalPatients }}</div>
          <div class="kpi-footer">
            <span class="kpi-subtext">12 new this month</span>
            <span class="kpi-trend positive">
              <i class="bi bi-arrow-up"></i>
              {{ dashboardData()!.trends.patientsChange }}% from last month
            </span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-header">
            <h3>Avg. Consultation</h3>
            <i class="bi bi-clock kpi-icon"></i>
          </div>
          <div class="kpi-value">{{ dashboardData()!.stats.avgConsultationTime }} min</div>
          <div class="kpi-footer">
            <span class="kpi-subtext">Well within target time</span>
            <span class="kpi-trend positive">
              <i class="bi bi-arrow-down"></i>
              {{ abs(dashboardData()!.trends.consultationChange) }} min improvement
            </span>
          </div>
        </div>

        <div class="kpi-card revenue">
          <div class="kpi-header">
            <h3>Satisfaction Rate</h3>
            <i class="bi bi-graph-up kpi-icon"></i>
          </div>
          <div class="kpi-value">{{ dashboardData()!.stats.satisfactionRate }}/5</div>
          <div class="kpi-footer">
            <span class="kpi-subtext">Based on 45 reviews</span>
            <span class="kpi-trend positive">
              <i class="bi bi-arrow-up"></i>
              {{ dashboardData()!.trends.satisfactionChange }} points
            </span>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-grid">
        <!-- Appointment Flow Chart -->
        <div class="chart-card">
          <h3 class="chart-title">Today's Appointment Flow</h3>
          <p class="chart-subtitle">Completed and pending appointments by time</p>
          <div class="chart-container">
            <div class="chart-bars">
              <div *ngFor="let label of getChartData().labels; let i = index" class="bar-wrapper">
                <div class="bars-group">
                  <div
                    class="bar completed"
                    [style.height.%]="getBarHeight(getCompletedValue(i), getMaxChartValue())"
                    [title]="'Completed: ' + getCompletedValue(i)"
                  ></div>
                  <div
                    class="bar pending"
                    [style.height.%]="getBarHeight(getPendingValue(i), getMaxChartValue())"
                    [title]="'Pending: ' + getPendingValue(i)"
                  ></div>
                </div>
                <div class="bar-label">{{ label }}</div>
              </div>
            </div>
            <div class="chart-legend">
              <div class="legend-item">
                <div class="legend-color completed"></div>
                <span>completed</span>
              </div>
              <div class="legend-item">
                <div class="legend-color pending"></div>
                <span>pending</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Metrics Chart -->
        <div class="chart-card">
          <h3 class="chart-title">Performance Metrics</h3>
          <p class="chart-subtitle">Patient satisfaction and referrals trend</p>
          <div class="chart-container">
            <div class="performance-chart">
              <div class="chart-placeholder">
                <p>Performance metrics visualization</p>
                <small>Jan - Jun 2025</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
