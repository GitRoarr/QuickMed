<app-patient-shell active="profile">
  <div class="profile-page" *ngIf="user() as profile">
    <!-- Top Patient Info Card -->
    <div class="profile-hero">
      <div class="profile-hero__avatar">
        <img *ngIf="profile.avatar; else initials" [src]="profile.avatar" alt="{{ profile.firstName }}" />
        <ng-template #initials>
          {{ ((profile.firstName || '').charAt(0) || 'A') + ((profile.lastName || '').charAt(0) || 'J') }}
        </ng-template>
      </div>
      <div class="profile-hero__info">
        <h1>{{ profile.firstName }} {{ profile.lastName }}</h1>
        <p class="muted">Patient ID: {{ profile.patientId || profile.id }}</p>
        <div class="profile-hero__chips">
          <span class="chip"><i class="bi bi-heart-pulse"></i> Patient Profile</span>
          <span class="chip accent"><i class="bi bi-shield-check"></i> Verified</span>
        </div>
      </div>
    </div>

    <!-- Profile Form -->
    <form class="profile-grid" [formGroup]="profileForm" (ngSubmit)="saveProfile()">
      <!-- Personal Info -->
      <div class="section-card span-2">
        <div class="section-card__header">
          <div>
            <h3>Personal Information</h3>
            <p class="muted">Keep your identity and contact information up to date.</p>
          </div>
        </div>
        <div class="form-grid">
          <label>
            <span>First Name</span>
            <input formControlName="firstName" type="text" />
          </label>
          <label>
            <span>Last Name</span>
            <input formControlName="lastName" type="text" />
          </label>
          <label>
            <span>Email</span>
            <input type="email" [value]="profile.email" disabled />
          </label>
          <label>
            <span>Phone</span>
            <input formControlName="phoneNumber" type="text" />
          </label>
        </div>
      </div>

      <!-- Health Info -->
      <div class="section-card span-2">
        <div class="section-card__header">
          <div>
            <h3>Health Information</h3>
            <p class="muted">Store your latest vitals and clinical information.</p>
          </div>
        </div>
        <div class="form-grid">
          <label>
            <span>Blood Type</span>
            <input formControlName="bloodType" type="text" />
          </label>
          <label>
            <span>Allergies (comma separated)</span>
            <input formControlName="allergies" type="text" />
          </label>
          <label>
            <span>Blood Pressure Systolic</span>
            <input formControlName="bloodPressureSystolic" type="number" min="0" />
          </label>
          <label>
            <span>Blood Pressure Diastolic</span>
            <input formControlName="bloodPressureDiastolic" type="number" min="0" />
          </label>
          <label>
            <span>Heart Rate (BPM)</span>
            <input formControlName="heartRate" type="number" min="0" />
          </label>
          <label>
            <span>BMI</span>
            <input formControlName="bmi" type="number" min="0" step="0.1" />
          </label>
          <label>
            <span>Last Checkup</span>
            <input formControlName="lastCheckupDate" type="date" />
          </label>
        </div>
      </div>

      <!-- Account Info -->
      <div class="account-card">
        <h3>Account Information</h3>
        <div class="account-meta">
          <div>
            <p class="label">Member since</p>
            <p>{{ profile.createdAt | date:'MMMM y' }}</p>
          </div>
          <div>
            <p class="label">Last update</p>
            <p>{{ profile.updatedAt | date:'mediumDate' }}</p>
          </div>
        </div>
        <p class="muted">Patient ID: {{ profile.patientId || profile.id }}</p>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button class="primary" type="submit" [disabled]="profileForm.invalid || saving()">
          {{ saving() ? 'Saving...' : 'Save changes' }}
        </button>
      </div>
    </form>
  </div>
</app-patient-shell>
