<app-patient-shell active="profile">
  <div class="profile-page" *ngIf="user() as profile">
    <!-- Hero Section -->
    <div class="hero">
      <div class="avatar">
        <img *ngIf="profile.avatar; else initials" [src]="profile.avatar" alt="{{ profile.firstName }}" />
        <ng-template #initials>
          {{ ((profile.firstName || '').charAt(0) || 'A') + ((profile.lastName || '').charAt(0) || 'J') }}
        </ng-template>
      </div>
      <div>
        <h1>{{ profile.firstName }} {{ profile.lastName }}</h1>
        <p class="muted">Patient ID: {{ profile.patientId || profile.id }}</p>
      </div>
    </div>

    <!-- Profile Form -->
    <form class="edit-grid" [formGroup]="profileForm" (ngSubmit)="saveProfile()">
      <!-- Personal Info -->
      <div class="info-card span-2">
        <h3>Personal Info</h3>
        <div class="two-col">
          <label>
            <span>First Name</span>
            <input formControlName="firstName" type="text" />
          </label>
          <label>
            <span>Last Name</span>
            <input formControlName="lastName" type="text" />
          </label>
          <label>
            <span>Email</span>
            <input type="email" [value]="profile.email" disabled />
          </label>
          <label>
            <span>Phone</span>
            <input formControlName="phoneNumber" type="text" />
          </label>
        </div>
      </div>

      <!-- Health Info -->
      <div class="info-card span-2">
        <h3>Health Info</h3>
        <div class="two-col">
          <label>
            <span>Blood Type</span>
            <input formControlName="bloodType" type="text" />
          </label>
          <label>
            <span>Allergies (comma separated)</span>
            <input formControlName="allergies" type="text" />
          </label>
          <label>
            <span>Blood Pressure Systolic</span>
            <input formControlName="bloodPressureSystolic" type="number" min="0" />
          </label>
          <label>
            <span>Blood Pressure Diastolic</span>
            <input formControlName="bloodPressureDiastolic" type="number" min="0" />
          </label>
          <label>
            <span>Heart Rate (BPM)</span>
            <input formControlName="heartRate" type="number" min="0" />
          </label>
          <label>
            <span>BMI</span>
            <input formControlName="bmi" type="number" min="0" step="0.1" />
          </label>
          <label>
            <span>Last Checkup</span>
            <input formControlName="lastCheckupDate" type="date" />
          </label>
        </div>
      </div>

      <!-- Account Info -->
      <div class="info-card">
        <h3>Account Info</h3>
        <p>Member since {{ profile.createdAt | date:'MMMM y' }}</p>
        <p>Last update {{ profile.updatedAt | date:'mediumDate' }}</p>
        <p class="muted">Patient ID: {{ profile.patientId || profile.id }}</p>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button class="primary" type="submit" [disabled]="profileForm.invalid || saving()">
          {{ saving() ? 'Saving...' : 'Save changes' }}
        </button>
      </div>
    </form>
  </div>
</app-patient-shell>
