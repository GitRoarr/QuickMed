<div class="patient-shell" [class.sidebar-open]="sidebarOpen" [class.dark]="themeService.isDarkMode()">
  <aside class="patient-shell__sidebar">
    <div class="patient-shell__brand" (click)="navigate('/')" title="Back to Home">
      <div class="brand-container">
        <div class="brand-icon">
          <img src="assets/images/QuickMed-Logo.png" alt="QuickMed Logo" />
        </div>
        <div class="brand-text">
          <p class="brand-title">QuickMed</p>
          <p class="brand-subtitle">Patient Portal</p>
        </div>
      </div>
    </div>

    <nav class="patient-shell__nav" [attr.aria-hidden]="!sidebarOpen && mobile">
      <a
        *ngFor="let item of menuItems"
        class="patient-shell__nav-item"
        [routerLink]="item.route"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: item.exact !== false }"
        (click)="closeSidebar()"
      >
        <i class="bi" [ngClass]="item.icon"></i>
        <span>{{ item.label }}</span>
      </a>
    </nav>

    <div class="patient-shell__profile" *ngIf="user as current">
      <div class="avatar">
        <img *ngIf="current.avatar; else initials" [src]="current.avatar" alt="{{ current.firstName }}" />
        <ng-template #initials>
          {{ (current.firstName.charAt(0) || 'A') + (current.lastName.charAt(0) || 'J') }}
        </ng-template>
      </div>
      <div>
        <p class="profile-name">{{ current.firstName }} {{ current.lastName }}</p>
        <p class="profile-id">{{ current.patientId || current.id }}</p>
      </div>
    </div>

    <button class="patient-shell__logout" type="button" (click)="logout(); closeSidebar()">
      <i class="bi bi-box-arrow-right"></i>
      Logout
    </button>
  </aside>

  <main class="patient-shell__content">
    <div class="patient-shell__topbar">
      <button class="patient-shell__icon-btn" type="button" [routerLink]="'/patient/messages'" title="Messages">
        <i class="bi bi-chat-dots"></i>
        <span class="patient-shell__badge" *ngIf="unreadMessages() > 0">{{ unreadMessages() }}</span>
      </button>
      <button class="patient-shell__icon-btn" type="button" [routerLink]="'/patient/settings'" title="Notifications">
        <i class="bi bi-bell"></i>
        <span class="patient-shell__badge" *ngIf="unreadNotifications() > 0">{{ unreadNotifications() }}</span>
      </button>
      <button class="patient-shell__icon-btn" type="button" (click)="toggleTheme()" title="Toggle theme">
        <i class="bi" [ngClass]="themeService.isDarkMode() ? 'bi-moon' : 'bi-brightness-high'"></i>
      </button>
      <button class="hamburger" type="button" aria-label="Toggle menu" (click)="toggleSidebar()" *ngIf="mobile">
        <span class="hamburger-box">
          <span class="hamburger-inner"></span>
        </span>
      </button>
    </div>
    <ng-content></ng-content>
  </main>
</div>
