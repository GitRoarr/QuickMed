<div class="doctors-container">
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed()">
    <div class="sidebar-header">
      <div class="logo" *ngIf="!sidebarCollapsed()">
        <div class="logo-icon">
          <i class="bi bi-activity"></i>
        </div>
        <div class="logo-text">
          <h3>QuickMed</h3>
          <p>Patient Portal</p>
        </div>
      </div>
      <button class="toggle-btn" (click)="toggleSidebar()">
        <i class="bi" [class.bi-chevron-right]="sidebarCollapsed()" [class.bi-chevron-left]="!sidebarCollapsed()"></i>
      </button>
    </div>

    <nav class="sidebar-nav">
      <a *ngFor="let item of menuItems" 
         [routerLink]="item.route" 
         class="nav-item"
         [class.active]="item.active">
        <i class="bi" [class]="'bi ' + item.icon"></i>
        <span *ngIf="!sidebarCollapsed()">{{ item.label }}</span>
      </a>
    </nav>
  </aside>

  <main class="main-content">
    <div class="page-header">
      <h1 class="page-title">Find Doctors</h1>
      <p class="page-subtitle">Browse and book appointments with our healthcare professionals</p>
    </div>

    <div class="search-section">
      <div class="search-bar">
        <i class="bi bi-search search-icon"></i>
        <input 
          type="text" 
          placeholder="Search by name, specialty, or expertise..." 
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()"
          class="search-input"
        />
      </div>

      <div class="specialty-filter">
        <label>Specialty:</label>
        <select [(ngModel)]="selectedSpecialty" (ngModelChange)="onSpecialtyChange()" class="specialty-select">
          <option *ngFor="let specialty of specialties" [value]="specialty.value">
            {{ specialty.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="results-info" *ngIf="!isLoading()">
      <p>Found {{ filteredDoctors().length }} doctors</p>
    </div>

    <div class="doctors-grid" *ngIf="!isLoading()">
      <div *ngFor="let doctor of filteredDoctors()" class="doctor-card">
        <div class="doctor-header">
          <div class="doctor-avatar">
            <i class="bi bi-person-circle"></i>
          </div>
          <div class="doctor-status" [class.available]="doctor.available">
            {{ doctor.available ? 'Available' : 'Unavailable' }}
          </div>
        </div>

        <div class="doctor-info">
          <h3>Dr. {{ doctor.firstName }} {{ doctor.lastName }}</h3>
          <p class="specialty">{{ doctor.specialty }}</p>
          
          <div class="rating">
            <span *ngFor="let star of getStarArray(doctor.rating || 0)" class="star">
              <i class="bi bi-star-fill"></i>
            </span>
            <span class="rating-text">{{ doctor.rating }} ({{ doctor.experience }}+ years)</span>
          </div>

          <p class="bio">{{ doctor.bio }}</p>

          <div class="contact-info">
            <div class="contact-item">
              <i class="bi bi-telephone"></i>
              <span>{{ doctor.phoneNumber }}</span>
            </div>
            <div class="contact-item">
              <i class="bi bi-envelope"></i>
              <span>{{ doctor.email }}</span>
            </div>
          </div>
        </div>

        <button 
          class="book-btn" 
          (click)="selectDoctor(doctor)"
          [disabled]="!doctor.available">
          <i class="bi bi-calendar-plus"></i>
          {{ doctor.available ? 'Book Appointment' : 'Unavailable' }}
        </button>
      </div>

      <div *ngIf="filteredDoctors().length === 0" class="empty-state">
        <i class="bi bi-search"></i>
        <h3>No doctors found</h3>
        <p>Try adjusting your search or filters</p>
      </div>
    </div>

    <div *ngIf="isLoading()" class="loading-state">
      <div class="spinner"></div>
      <p>Loading doctors...</p>
    </div>
  </main>

  <div class="modal-overlay" *ngIf="showBookingForm()" (click)="closeBookingForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Book Appointment</h2>
        <button class="close-btn" (click)="closeBookingForm()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="modal-body" *ngIf="selectedDoctor()">
        <div class="doctor-summary">
          <div class="doctor-avatar-small">
            {{ getSelectedDoctorInitial() }}
          </div>
          <div>
            <h4>Dr. {{ selectedDoctor()?.firstName }} {{ selectedDoctor()?.lastName }}</h4>
            <p>{{ selectedDoctor()?.specialty }}</p>
          </div>
        </div>

        <form [formGroup]="appointmentForm" (ngSubmit)="bookAppointment()">
          <div class="form-group">
            <label for="appointmentDate">Appointment Date</label>
            <input 
              type="date" 
              id="appointmentDate" 
              class="form-control"
              formControlName="appointmentDate"
              [min]="getCurrentDate()"
            />
            <div class="error-message" *ngIf="appointmentForm.get('appointmentDate')?.invalid && appointmentForm.get('appointmentDate')?.touched">
              Please select a date
            </div>
          </div>

          <div class="form-group">
            <label for="appointmentTime">Appointment Time</label>
            <input 
              type="time" 
              id="appointmentTime" 
              class="form-control"
              formControlName="appointmentTime"
            />
            <div class="error-message" *ngIf="appointmentForm.get('appointmentTime')?.invalid && appointmentForm.get('appointmentTime')?.touched">
              Please select a time
            </div>
          </div>

          <div class="form-group">
            <label for="notes">Notes (Optional)</label>
            <textarea 
              id="notes" 
              class="form-control"
              formControlName="notes"
              rows="4"
              placeholder="Add any notes or special requests..."
            ></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-outline" (click)="closeBookingForm()">
              Cancel
            </button>
            <button type="submit" class="btn-primary" [disabled]="appointmentForm.invalid">
              <i class="bi bi-check-circle"></i>
              Confirm Booking
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
