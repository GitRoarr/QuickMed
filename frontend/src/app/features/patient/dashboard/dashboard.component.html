<div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo-section">
                <img src="/assets/images/doctors-illustration.jpg" alt="QuickMed" class="logo-img" />
                <div>
                    <h1 class="logo-title">QuickMed</h1>
                    <p class="logo-subtitle">Patient Portal</p>
                </div>
            </div>

            <div class="header-actions">
                <button class="icon-btn" (click)="toggleTheme()" title="Toggle theme">
          <i class="bi bi-sun-fill"></i>
        </button>
                <button class="emergency-btn">
          <i class="bi bi-telephone-fill"></i>
          Emergency
        </button>
                <div class="profile-icon">
                    <i class="bi bi-person-circle"></i>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-content">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h2 class="welcome-title">Welcome back, {{ currentUser?.firstName }} {{ currentUser?.lastName }}</h2>
            <p class="welcome-subtitle">Manage your appointments and health records</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon stat-icon-green">
                    <i class="bi bi-calendar-check"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Upcoming</p>
                    <h3 class="stat-value">{{ upcomingCount }}</h3>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon stat-icon-green">
                    <i class="bi bi-capsule"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Active Meds</p>
                    <h3 class="stat-value">{{ currentUser?.activeMedicationsCount || 0 }}</h3>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon stat-icon-green">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Records</p>
                    <h3 class="stat-value">{{ currentUser?.medicalRecordsCount || 0 }}</h3>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon stat-icon-orange">
                    <i class="bi bi-activity"></i>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Test Results</p>
                    <h3 class="stat-value">{{ currentUser?.testResultsCount || 0 }}</h3>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <!-- Main Content -->
            <div class="main-section">
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab-btn" [class.active]="activeTab === 'appointments'" (click)="activeTab = 'appointments'">
            Appointments
          </button>
                    <button class="tab-btn" [class.active]="activeTab === 'history'" (click)="activeTab = 'history'">
            Medical History
          </button>
                    <button class="tab-btn" [class.active]="activeTab === 'prescriptions'" (click)="activeTab = 'prescriptions'">
            Prescriptions
          </button>
                    <button class="tab-btn" [class.active]="activeTab === 'tests'" (click)="activeTab = 'tests'">
            Test Results
          </button>
                </div>

                <!-- Appointments Section -->
                <div *ngIf="activeTab === 'appointments'" class="appointments-section">
                    <div class="section-header">
                        <h3 class="section-title">Upcoming Appointments</h3>
                        <button class="book-btn">
              <i class="bi bi-plus-lg"></i>
              Book Appointment
            </button>
                    </div>

                    <div *ngIf="isLoading" class="loading-state">
                        <div class="spinner"></div>
                    </div>

                    <div *ngIf="!isLoading && appointments.length === 0" class="empty-state">
                        <p>No upcoming appointments</p>
                        <button class="book-btn">Book Your First Appointment</button>
                    </div>

                    <div *ngIf="!isLoading && appointments.length > 0" class="appointments-list">
                        <div *ngFor="let appointment of appointments" class="appointment-card">
                            <div class="appointment-header">
                                <div class="doctor-info">
                                    <div class="doctor-avatar">
                                        {{ getInitials(appointment.doctor) }}
                                    </div>
                                    <div>
                                        <h4 class="doctor-name">Dr. {{ appointment.doctor?.firstName }} {{ appointment.doctor?.lastName }}</h4>
                                        <p class="doctor-specialty">{{ appointment.doctor?.specialty }}</p>
                                    </div>
                                </div>
                                <span class="status-badge" [class]="'status-' + appointment.status">
                  {{ appointment.status }}
                </span>
                            </div>

                            <div class="appointment-details">
                                <div class="detail-item">
                                    <i class="bi bi-calendar3"></i>
                                    <span>{{ appointment.appointmentDate | date: 'yyyy-MM-dd' }}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="bi bi-clock"></i>
                                    <span>{{ appointment.appointmentTime }}</span>
                                </div>
                                <div *ngIf="appointment.location" class="detail-item">
                                    <i class="bi bi-geo-alt"></i>
                                    <span>{{ appointment.location }}</span>
                                </div>
                                <div *ngIf="appointment.isVideoConsultation" class="detail-item">
                                    <i class="bi bi-camera-video"></i>
                                    <span>Video Consultation</span>
                                </div>
                            </div>

                            <div class="appointment-actions">
                                <button *ngIf="appointment.isVideoConsultation && appointment.status === 'confirmed'" class="action-btn action-btn-primary">
                  <i class="bi bi-camera-video"></i>
                  Join Call
                </button>
                                <button class="action-btn action-btn-secondary">Reschedule</button>
                                <button class="action-btn action-btn-danger">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other tabs content -->
                <div *ngIf="activeTab !== 'appointments'" class="tab-content">
                    <p class="text-muted">Content for {{ activeTab }} will be displayed here.</p>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Profile Information -->
                <div class="profile-card">
                    <h3 class="card-title">Profile Information</h3>

                    <div class="profile-header">
                        <div class="profile-avatar-large">
                            {{ getInitials(currentUser) }}
                        </div>
                        <div>
                            <h4 class="profile-name">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</h4>
                            <p class="profile-id">Patient ID: {{ currentUser?.patientId || '#12345' }}</p>
                        </div>
                    </div>

                    <div class="profile-details">
                        <div class="profile-detail-item">
                            <i class="bi bi-envelope"></i>
                            <span>{{ currentUser?.email }}</span>
                        </div>
                        <div class="profile-detail-item">
                            <i class="bi bi-telephone"></i>
                            <span>{{ currentUser?.phoneNumber || '+1 (555) 123-4567' }}</span>
                        </div>
                        <div class="profile-detail-item">
                            <i class="bi bi-person"></i>
                            <span>
    DOB:
    {{
      currentUser?.dateOfBirth
        ? (currentUser?.dateOfBirth | date: 'MMMM d, yyyy')
        : 'Not provided'
    }}
  </span>
                        </div>

                        <div class="profile-detail-item">
                            <i class="bi bi-droplet"></i>
                            <span>Blood Type: {{ currentUser?.bloodType || 'O+' }}</span>
                        </div>
                    </div>
                    <div *ngIf="(currentUser?.allergies?.length ?? 0) > 0" class="allergies-section">
                        <h5 class="allergies-title">Allergies</h5>
                        <div class="allergies-list">
                            <span *ngFor="let allergy of currentUser?.allergies" class="allergy-badge">
      {{ allergy }}
    </span>
                        </div>
                    </div>




                    <button class="edit-profile-btn">Edit Profile</button>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions-card">
                    <h3 class="card-title">Quick Actions</h3>

                    <div class="quick-actions-list">
                        <button class="quick-action-btn">
              <i class="bi bi-calendar-plus"></i>
              <span>Book Appointment</span>
            </button>
                        <button class="quick-action-btn">
              <i class="bi bi-download"></i>
              <span>Download Records</span>
            </button>
                        <button class="quick-action-btn">
              <i class="bi bi-prescription2"></i>
              <span>Request Prescription</span>
            </button>
                        <button class="quick-action-btn">
              <i class="bi bi-telephone"></i>
              <span>Contact Support</span>
            </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</div>